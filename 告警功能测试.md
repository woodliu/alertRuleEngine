### Test

#### Test1

| 规则文件目录测试                              | 预期结果 |      |
| --------------------------------------------- | -------- | ---- |
| 无规则目录                                    | 程序退出 | pass |
| 规则目录中无规则文件                          | 正常运行 | pass |
| 规则文件中无告警规则                          | 正常运行 | pass |
| 规则文件的表达式错误                          | 程序退出 | pass |
| 规则文件初始有2条告警规则，查看初始化是否正确 | 正常运行 | pass |

#### Test2

RPC方式不涉及分布式，只有点对点

| 执行规则下发                                                 | 预期结果                                | pass |
| ------------------------------------------------------------ | --------------------------------------- | ---- |
| 获取告警规则基本功能--应用存在                               | 正常运行                                | pass |
| 获取告警规则基本功能--应用不存在                             | 正常运行，返回空                        | pass |
| 重复获取告警规则                                             | 正常运行                                | pass |
| 添加新应用告警规则，并查看添加的规则，表达式正确             | 正常添加生成规则文件                    | pass |
| 添加100个新应用告警规则，表达式正确                          | 启用新的goroutine处理                   | pass |
| 重复添加新应用告警规则，表达式正确                           | 返回错误，不会重复添加                  | pass |
| 添加新应用告警规则，告警表达式错误                           | 不生成告警文件，返回错误                | pass |
| 更新告警规则基本功能，更新告警名称、表达式                   | 更新成功                                | pass |
| 更新不存在的应用的告警规则                                   | rpc不支持更新不存在的告警规则，rest支持 | pass |
| 更新应用不存在的告警规则                                     | 新增告警                                | pass |
| 更新应用规则，部分id存在，部分id不存在                       | 正常操作                                | pass |
| 更新应用规则，id为0                                          | 添加该规则                              | pass |
| 更新应用规则，部分id为0，部分id不为0                         | 更新和添加规则成功                      | pass |
| 删除不存在的应用告警                                         | 正常运行                                | pass |
| 删除应用不存在的某条告警                                     | 正常运行                                | pass |
| 删除应用的部分告警规则基本功能                               | 正常运行                                | pass |
| 删除应用的所有告警规则基本功能                               | 正常运行                                | pass |
| 重复删除应用的某条告警规则告警                               | 正常运行                                | pass |
| 创建100个应用规则，观察是否有新goroutine生成，删除新增的100个应用规则，观察是否减少goroutine |                                         |      |
| 增删改查一起测试，验证是否正常                               |                                         |      |
| 并发执行各种操作，看是否有死锁，goroutine泄露，内存错误信息等 |                                         |      |

#### Test3

REST方式相比RPC，多了分布式操作

| REST执行规则下发                                             | 预期结果     | pass |
| ------------------------------------------------------------ | ------------ | ---- |
| 测试rest获取告警规则基本功能--应用存在                       |              |      |
| 测试rest获取告警规则基本功能--应用不存在                     |              |      |
| 测试rest添加新应用告警规则基本功能                           |              |      |
| 测试rest更新告警规则基本功能                                 |              |      |
| 测试rest删除应用的部分告警规则基本功能                       |              |      |
| 测试rest删除应用的所有告警规则基本功能                       |              |      |
| 测试rpc的非阻塞长连接功能，client和server连接之后，重启server，看client是否还能正常连接server | 可以断点续连 | pass |
|                                                              |              |      |
| 规则修改之后ID的变更，可能ID会变更                           |              |      |
|                                                              |              |      |
|                                                              |              |      |
|                                                              |              |      |
|                                                              |              |      |
|                                                              |              |      |

> 注：重复添加告警场景下，由于告警规则分布到各个集群的节点中，因此无法获得完整的告警视图，为了避免重复添加应用告警（使用list查找避免重复？）

更新的时候先查后改



| 其他                                | 预期结果 | pass |
| ----------------------------------- | -------- | ---- |
| 查看是否有goroutine泄露，内存泄露等 |          |      |
| 查看是否有不加锁的地方              |          |      |
| 读写冲突测试                        |          |      |
|                                     |          |      |
|                                     |          |      |
|                                     |          |      |

